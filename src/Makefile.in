CC = @CC@
RC = windres

DEFS = @DEFS@
LIBS = @LIBS@
TARGET = atari800@EXEEXT@

CFLAGS = @CFLAGS@
LDFLAGS = @LDFLAGS@

BIN_DIR = @prefix@/bin
LIB_DIR = @prefix@/lib
MAN_DIR = @prefix@/share/man/man1

OBJS = \
	atari.o \
	cpu.o \
	monitor.o \
	sio.o \
	devices.o \
	antic.o \
	gtia.o \
	pokey.o \
	pia.o \
	pbi.o \
	cartridge.o \
	rtime.o \
	prompts.o \
	rt-config.o \
	ui.o \
	ui_basic.o \
	binload.o \
	list.o \
	ataripcx.o \
	log.o \
	compfile.o \
	memory.o \
	statesav.o \
	colours.o \
	pokeysnd.o \
	mzpokeysnd.o \
	remez.o \
	sndsave.o \
	cassette.o \
	input.o \
	cycle_map.o \
	@OBJS@



all: $(TARGET)

%.o: %.c
	$(CC) -c -o $@ $(DEFS) $(CFLAGS) $<

%.ro: %.rc
	$(RC) --define WIN32 --define __MINGW32__ --include-dir . $< $@

%.o: %.cpp
	$(CC) -c -o $@ $(DEFS) $(CFLAGS) $<

%.o: %.asm
	cd $(<D); xgen -L1 $(@F) $(<F)
	cd $(<D); gst2gcc gcc $(@F)

$(TARGET): $(OBJS)
	$(CC) -o $@ $(LDFLAGS) $(OBJS) $(LIBS)

dep:
	@if ! makedepend -Y $(DEFS) ${OBJS:.o=.c} 2>/dev/null; \
	then echo warning: makedepend failed; fi

clean:
	rm -f *.o $(TARGET) core *.bak *~

distclean: clean
	-rm -f Makefile configure config.log config.status config.h
	-rm -rf autom4te.cache

install:
	cp $(TARGET) ${BIN_DIR}/$(TARGET)
	cp atari800.man ${MAN_DIR}/atari800.1

install-svgalib: install
	chown root.root ${BIN_DIR}/$(TARGET)
	chmod 4755 ${BIN_DIR}/$(TARGET)

readme.html: $(TARGET)
	./$(TARGET) -help </dev/null | ../util/usage2html.pl \
		../DOC/readme.html.in ../DOC/USAGE ./atari.h > $@

doc: readme.html
